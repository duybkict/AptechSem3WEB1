@model List<Product>

@if (Model.Count > 0) {
	for (int i = 0; i < Model.Count; ) {
	<div class="row-fluid row-products">
		@for (int j = 0; j < 4 && i < Model.Count; j++, i++) { 
			@Html.Partial("_PartialProduct", Model.ElementAt(i))
  }
	</div>
	<!--/ row-products -->
	}
} else {
	<span>No products available!</span>
}

<script type="text/javascript">
	$('.btn-shopping-cart').click(function () {
		//$('#modalShoppingCart > .modal-body').load('Products/AddToCart/' + $(this).attr('data-product-id'));
		switch ($(this).attr('data-action')) {
			case 'AddToCart':
				urlString = '/Products/AddToCart/' + $(this).attr('data-product-id');
				break;
			case 'ShowCart':
				urlString = '/Products/ShowCart';
				break;
			default:
				urlString = '';
		}

		$.ajax({
			url: urlString,
			success: function (result) {				
				$('#modalShoppingCart > .modal-body').html(result);
			},
			error: function (jqXHR, textStatus, errorThrown) {
				alert("An error has occured: " + errorThrown);
			},
			complete: function () {
				$.ajax({
					url: '/Products/CountCart',
					success: function (result) {
						$('#shoppingCartCount').html(result);
						$('#modalShoppingCartHeader').html('Shopping Cart (' + result + ')');
					},
					error: function (jqXHR, textStatus, errorThrown) {
						alert("An error has occured: " + errorThrown);
					}
				});
			}
		});
		
		$('#modalShoppingCart').modal('show');
	});
</script>
